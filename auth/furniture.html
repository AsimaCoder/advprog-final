<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
    <title>Furniture - Online Furniture Shop</title>
    <style>
        #furniture-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .furniture-card {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            width: 200px;
        }

        .furniture-card img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
        }

        .furniture-title {
            font-size: 1.1em;
            margin: 5px 0;
        }

        .furniture-price {
            font-weight: bold;
        }

        #page {
            width: 50px;
        }
    </style>
</head>

<body>
    <h1>Furniture - Online Furniture Shop</h1>
    <div>
        <label for="minPrice">Min Price:</label>
        <input type="number" id="minPrice" placeholder="Min Price">

        <label for="maxPrice">Max Price:</label>
        <input type="number" id="maxPrice" placeholder="Max Price">

        <button onclick="applyFilter()">Apply Filter</button>

    </div>

    <div>
        <label for="sortDropdown">Sort by:</label>
        <select id="sortDropdown">
            <option value="name_asc">A to Z</option>
            <option value="name_desc">Z to A</option>
            <option value="price_asc">0 - More</option>
            <option value="price_desc">More - 0</option>
        </select>
        <button onclick="applySorting()">Apply Sorting</button>
    </div>
    <div>
        <button onclick="loadPreviousPage()">Previous</button>

        <label for="itemsPerPage">Items per Page:</label>
        <input type="number" id="itemsPerPage" placeholder="Items per Page" value="10">


        <button onclick="loadNextPage()">Next</button>
    </div>
    <div id="furniture-container"></div>

    <script>
        let currentPage = 1;
        const itemsPerPage = 10;
        let sortBy = 'title';
        let sortOrder = 'asc';

        const container = document.getElementById('furniture-container');
        const pageInput = document.getElementById('page');

        function getUserID() {
            return localStorage.getItem('userID');
        }
        async function loadFurniture(sortBy, sortOrder, minPrice, maxPrice, page, itemsPerPage) {
            try {
                page = page && page >= 1 ? page : 1;
                const userID = await getUserID();

                const apiUrl = `/furniture?sort=${sortBy}&order=${sortOrder}&minPrice=${minPrice || ''}&maxPrice=${maxPrice || ''}&page=${page}&itemsPerPage=${itemsPerPage}`;

                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const data = await response.json();

                const fragment = document.createDocumentFragment();
                data.forEach(furniture => {
                    const card = document.createElement('div');
                    card.className = 'furniture-card';

                    const title = document.createElement('h2');
                    title.className = 'furniture-title';
                    title.textContent = furniture.title;

                    const pictures = document.createElement('img');
                    if (furniture.pictures && furniture.pictures.length > 0) {
                        pictures.src = furniture.pictures[0].medium;
                        pictures.alt = furniture.title;
                    }

                    const price = document.createElement('p');
                    price.className = 'furniture-price';
                    price.textContent = `Price: ${furniture.price}`;

                    card.appendChild(pictures);
                    card.appendChild(title);
                    card.appendChild(price);

                    fragment.appendChild(card);
                });

                container.innerHTML = '';
                container.appendChild(fragment);

                currentPage = page;
                if (pageInput) {
                    pageInput.value = currentPage;
                }
            } catch (error) {
                console.error('Error:', error);
                container.textContent = 'Failed to load furniture data.';
            }
        }
        function applyFilter() {
            const minPrice = document.getElementById('minPrice').value;
            const maxPrice = document.getElementById('maxPrice').value;
            const sortDropdown = document.getElementById('sortDropdown');
            const selectedValue = sortDropdown.value;

            switch (selectedValue) {
                case 'name_asc':
                    sortBy = 'title';
                    sortOrder = 'asc';
                    break;
                case 'name_desc':
                    sortBy = 'title';
                    sortOrder = 'desc';
                    break;
                case 'price_asc':
                    sortBy = 'price';
                    sortOrder = 'asc';
                    break;
                case 'price_desc':
                    sortBy = 'price';
                    sortOrder = 'desc';
                    break;
                default:
                    sortBy = 'title';
                    sortOrder = 'asc';
            }

            const userID = getUserID();
            loadFurniture(sortBy, sortOrder, minPrice, maxPrice, currentPage, itemsPerPage);
            logUserAction('applyFilter', userID);
        }

        function applySorting() {
            const sortDropdown = document.getElementById('sortDropdown');
            const selectedValue = sortDropdown.value;

            switch (selectedValue) {
                case 'name_asc':
                    sortBy = 'title';
                    sortOrder = 'asc';
                    break;
                case 'name_desc':
                    sortBy = 'title';
                    sortOrder = 'desc';
                    break;
                case 'price_asc':
                    sortBy = 'price';
                    sortOrder = 'asc';
                    break;
                case 'price_desc':
                    sortBy = 'price';
                    sortOrder = 'desc';
                    break;
                default:
                    sortBy = 'title';
                    sortOrder = 'asc';
            }

            const userID = getUserID();
            loadFurniture(sortBy, sortOrder);
            logUserAction('applySorting', userID);
        }
        applySorting();


        function applyPagination() {
            itemsPerPage = document.getElementById('itemsPerPage').value;
            const page = document.getElementById('page').value;

            loadFurniture(sortBy, sortOrder, minPrice, maxPrice, page, itemsPerPage);
        }


        function loadPreviousPage() {
            if (currentPage > 1) {
                const userID = getUserID();
                loadFurniture(sortBy, sortOrder, undefined, undefined, currentPage - 1, itemsPerPage);
                logUserAction('loadPreviousPage', userID);
            }
        }

        function loadNextPage() {
            const userID = getUserID();
            loadFurniture(sortBy, sortOrder, undefined, undefined, currentPage + 1, itemsPerPage);
            logUserAction('loadNextPage', userID);
        }
        function logUserAction(action, userID) {
            fetch('http://localhost:8080/logUserAction', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: action,
                    userID: userID,
                }),
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }


        // Initial load
        loadFurniture('title', 'asc', undefined, undefined, currentPage, itemsPerPage);
    </script>
</body>

</html>
